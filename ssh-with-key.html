<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  SSH with key | garret
</title>
  <link rel="canonical" href="https://imjang57.github.io/garret/ssh-with-key.html">


  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://imjang57.github.io/garret/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://imjang57.github.io/garret/feeds/tools.atom.xml">  
  <meta name="description" content="Key 로 SSH 로그인 하기 위한 과정">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-90095241-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="https://imjang57.github.io/garret/">garret</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://github.com/imjang57" target="_blank">Github</a></li>
          <li class="list-inline-item"><a href="https://github.com/imjang57/garret" target="_blank">Github site repo</a></li>
          <li class="list-inline-item"><a href="#" target="_blank">Site</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="https://imjang57.github.io/garret/pages/about.html">About</a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  SSH with key
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2017-01-02T00:00:00+09:00">
          <i class="fa fa-clock-o"></i>
          Mon 02 January 2017
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="https://imjang57.github.io/garret/category/tools.html">tools</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="https://imjang57.github.io/garret/tag/ssh.html">#ssh</a>,               <a href="https://imjang57.github.io/garret/tag/key-gen.html">#key-gen</a>          </li>
      </ul>
    </header>
    <div class="content">
      <h1>SSH with key file</h1>
<p>SSH를 사용할 때 비밀번호를 일일이 입력하기 귀찮을 때가 있다. 특히 개발용 서버에 수시로 접속할 때... 이 때 키(Key) 파일을 이용한 로그인을 하면 비밀번호를 입력하는 번거로움을 피할 수 있다. 또한, 비밀키(Private Key) 를 잘 관리하여 SSH 접속에 대한 보안을 강화할 수도 있다. 물론 모든 보안이 그렇듯이 얼마나 비밀키를 잘 관리하느냐가 중요하다.</p>
<p>SSH에서 키를 이용한 로그인을 위해 키파일(Key file)을 생성하고 SSH 서버에 키의 정보를 등록해주어야 한다. 키를 생성할 때 여러 암호화 알고리즘을 사용할 수 있지만 보통 RSA 비대칭키 암호화(RSA asymmetric encryption) 방식을 많이 사용한다. RSA 키파일을 생성하고 이 키를 이용하여 SSH 로그인하기 위해 다음과 같은 과정이 필요하다.</p>
<ol>
<li>공개키(Public Key) 와 비밀키(Private Key) 를 생성</li>
<li>로컬 호스트(Local Host), 즉 SSH 클라이언트(SSH Client)에 비밀키를 저장</li>
<li>원격 호스트(Remote Host), 즉 SSH 서버(SSH Server)에 공개키를 등록</li>
</ol>
<p>SSH 접속이 진행되는 과정을 살펴보면 다음과 같다.</p>
<ol>
<li>SSH 클라이언트가 SSH 서버 측에 접속 요청</li>
<li>SSH 서버는 자신의 공개키(위에서 생성한 키가 아니라 원래 SSH 서버가 가지고 있는 키)를 SSH 클라이언트에게 전달</li>
<li>SSH 클라이언트는 SSH 서버가 전달한 공개키로 자신의 비밀키를 암호화하여 SSH 서버에게 전달</li>
<li>SSH 서버는 자신이 가진 공개키 목록을 보고 SSH 클라이언트가 전달한 비밀키와 매칭되는 공개키가 있으면 로그인을 승인</li>
</ol>
<p>위에서 언급한 대로 로그인 과정에서는 비대칭키를 사용한다. 하지만 로그인이 성공한 이후에는 대칭키를 만들고, 비대칭키로 생성된 대칭키를 공유하고, 이후 데이터 전송에는 이 대칭키(Symmetric key)를 사용한다. 비대칭키는 연산이 더 오래걸리기 때문이다.</p>
<h2>Key 생성</h2>
<p>먼저 Public Key 와 Private Key 를 생성한다. 리눅스에서는 아래와 같은 명령을 실행하면 된다.</p>
<div class="highlight"><pre><span></span>$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key <span class="o">(</span>/home/axl/.ssh/id_rsa<span class="o">)</span>: &lt;<span class="k">return</span>&gt;
Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>: &lt;Type the passphrase&gt;
Enter same passphrase again: &lt;Type the passphrase&gt;
</pre></div>


<p><code>ssh-keygen</code> 을 실행하면 key file 이 저장될 위치와 passphrase 를 차례대로 묻는다. 저장될 위치는 기본값으로 <code>$HOME/.ssh/</code> 이다. 특별히 변경할 일이 없다면 그대로 엔터를 입력하여 기본값으로 사용하자. <code>passphrase</code> 는 비밀키를 생성하는데 사용될 문자열로 이 문자열을 암호화하여 키를 생성한다. 자동 로그인을 원한다면 생략해야 한다.</p>
<p>키가 정상적으로 생성되면 키가 생성된 곳에 아래와 같은 파일들을 볼 수 있다. 참고로 아래 파일들은 SSH 를 사용할 때 보안에 매우 중요한 파일들이다.</p>
<div class="highlight"><pre><span></span>drwx------  <span class="m">2</span> ubuntu ubuntu <span class="m">4096</span> Feb <span class="m">18</span> 18:54 .
drwxr-xr-x <span class="m">16</span> ubuntu ubuntu <span class="m">4096</span> Mar  <span class="m">1</span> 06:02 ..
-rw-rw-r--  <span class="m">1</span> ubuntu ubuntu  <span class="m">790</span> Feb <span class="m">19</span> 06:04 authorized_keys
-rw-------  <span class="m">1</span> ubuntu ubuntu <span class="m">1675</span> Feb <span class="m">18</span> 18:51 id_rsa
-rw-r--r--  <span class="m">1</span> ubuntu ubuntu  <span class="m">395</span> Feb <span class="m">18</span> 18:51 id_rsa.pub
-rw-r--r--  <span class="m">1</span> ubuntu ubuntu <span class="m">2216</span> Feb <span class="m">19</span> 18:34 known_hosts
</pre></div>


<p><code>authorized_keys</code> 파일은 없을수도 있다. 보통 SSH 서버 측에서 접속을 허용할 공개키 정보를 저장하는 파일이다. <code>id_rsa</code> 파일은 비밀키를 저장한 파일이다. 매우 중요하므로 절대로 타인에게 노출되면 안된다. 또한, 함부로 수정되어서는 안되므로 파일 권한을 꼭 600으로 지정해주자. <code>id_rsa.pub</code> 파일은 공개키를 저장한 파일이다. 접속하려는 원격 호스트의 <code>authorized_keys</code>에 <code>id_rsa.pub</code>파일에 저장된 공개키를 추가해야 키를 이용한 로그인을 할 수 있다.</p>
<h2>Remote Host 에 Public Key 등록</h2>
<p>이제 <code>id_rsa.pub</code> 파일을 리모트 서버의 <code>$HOME/.ssh/authorized_keys</code> 파일에 추가해줘야 한다. SSH Server의 <code>authorized_keys</code> 의 내용이 SSH Client의 <code>id_rsa.pub</code> 파일과 같아야 한다.</p>
<p>아래와 같이 SCP (Secure Copy) 를 이용하여 Public Key 를 Remote Host 에 복사한다.</p>
<div class="highlight"><pre><span></span><span class="x">scp </span><span class="p">$</span><span class="nv">HOME</span><span class="x">/.ssh/id_rsa.pub root@server.net:id_rsa.pub</span>
</pre></div>


<p>그리고 Public Key 를 Remote Host 의 authorized_keys 에 추가한다.</p>
<div class="highlight"><pre><span></span><span class="x">cat </span><span class="p">$</span><span class="nv">HOME</span><span class="x">/id_rsa.pub &gt;&gt; </span><span class="p">$</span><span class="nv">HOME</span><span class="x">/.ssh/authorized_keys</span>
</pre></div>


<h2>SSH 접속</h2>
<p>이후에는 비밀번호 없이 바로 SSH 접속이 가능하다.</p>
<p>만약 Private Key 를 다른 곳에 저장했다면 아래와 같이 <code>-i</code> 옵션을 사용하여 키를 지정할 수 있다.</p>
<div class="highlight"><pre><span></span>$ ssh root@server.net -i keyfile
</pre></div>


<h2>Remote Host 의 SSHD 설정</h2>
<p>Key 를 이용한 SSH 로그인을 사용하기 위해서는 Remote Host 의 SSHD 설정에서 RSA 키 인증을 사용하도록 설정해야 한다. 아래와 같은 내용이 있는지 SSHD 설정 파일 (<code>/etc/ssh/sshd_config</code>) 을 확인한다.</p>
<div class="highlight"><pre><span></span>RSAAuthentication yes
#DSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
</pre></div>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://imjang57.github.io/garret/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://imjang57.github.io/garret/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://imjang57.github.io/garret/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>