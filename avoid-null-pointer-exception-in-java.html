<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  NPE (NullPointerException) 을 피하자 | garret
</title>
  <link rel="canonical" href="https://imjang57.github.io/garret/avoid-null-pointer-exception-in-java.html">


  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://imjang57.github.io/garret/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://imjang57.github.io/garret/feeds/programming.atom.xml">  
  <meta name="description" content="Java 에서 NPE (NullPointerException) 을 피하면서 코딩하기 위한 습관들">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-90095241-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="https://imjang57.github.io/garret/">garret</a></h1>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://github.com/imjang57" target="_blank">Github</a></li>
          <li class="list-inline-item"><a href="https://github.com/imjang57/garret" target="_blank">Github site repo</a></li>
          <li class="list-inline-item"><a href="#" target="_blank">Site</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="https://imjang57.github.io/garret/pages/about.html">About</a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  NPE (NullPointerException) 을 피하자
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2017-01-18T00:00:00+09:00">
          <i class="fa fa-clock-o"></i>
          수 18 1월 2017
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="https://imjang57.github.io/garret/category/programming.html">programming</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="https://imjang57.github.io/garret/tag/java.html">#java</a>,               <a href="https://imjang57.github.io/garret/tag/npe.html">#NPE</a>,               <a href="https://imjang57.github.io/garret/tag/nullpointerexception.html">#NullPointerException</a>,               <a href="https://imjang57.github.io/garret/tag/null.html">#null</a>          </li>
      </ul>
    </header>
    <div class="content">
      <h1>NPE(NullPointerException) 을 피하자.</h1>
<p>자바 개발을 하다보면 가장 많이 만나고 영향이 큰 예외 중 하나가 <em>NPE</em> 이다. NPE 는 개발자의 습관이나 부주의 등이 대부분 원인이다. 이를 예방하는 가장 좋은 방법은 NPE 를 피하는 코딩 습관을 갖는 것이다.</p>
<h2>null 의 의미</h2>
<p>자바에서 <code>null</code> 이란 아래와 같은 상태를 의미한다.</p>
<blockquote>
<p>아직 object 가 생성되지 않은 상태, 즉 아직 memory 할당이 되지 않은 object 상태</p>
</blockquote>
<p>NPE 는 null 상태인 object 를 참조하여 어떠한 행위(method 실행)를 하려할 때 발생하는 예외이다.</p>
<h2>NPE가 발생하는 상황</h2>
<p>NPE 는 아래와 같은 상황에서 발생할 수 있다.</p>
<ul>
<li>null object 의 method 를 호출</li>
<li>null object 의 instance member 에 접근</li>
</ul>
<h1>Avoid NPE in source code</h1>
<p>NPE 는 대부분 개발자의 부주의로 발생하므로, 개발할 때 조금만 신경쓰면 대부분의 NPE 를 예방할 수 있다.</p>
<h2>String 객체를 비교할 경우</h2>
<p><code>equals()</code>, <code>equalsIgnoreCase()</code> 등을 사용할 때 null 이 아닌 것이 확실한 객체가 있다면 해당 객체의 method 를 호출하자.</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="o">(</span> <span class="s">&quot;Compare String&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">testStr</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
 <span class="c1">// logic</span>
<span class="o">}</span>
</pre></div>


<h2>String.valueOf() 사용</h2>
<p>로그 등을 남길 때 객체의 상태를 확인하기 위해 객체의 <code>toString()</code> 을 호출하는 경우가 있는데, 객체가 null 일 경우 NPE 가 발생한다. 로그를 위해 null 을 체크하는 로직을 추가하는 것은 불필요한 코드가 될 수 있다.</p>
<p><code>toString()</code> method 보다는 <code>String.valueOf()</code> 를 사용하자.</p>
<h2>Primitive type 사용</h2>
<p>꼭 필요한 경우가 아니라면 Primitive type data 를 사용하자. NPE 를 줄이고 memory 도 더 효율적으로 사용할 수 있다.</p>
<h2>return empty collection</h2>
<p>List, Set, Map 등과 같은 Collection 을 return 하는 method 를 구현할 때, null 을 return 하지 말자. 대신 empty collection 을 return 하자. 그러면 함수를 사용하는 개발자는 불필요한 null 체크를 하지 않아도 된다.</p>
<h2>Use null-safe stuffs</h2>
<p>null 에 안전한 자바 내장 함수나 commons-lang 과 같은 helper class 를 사용하자. Apache Commons 도 좋고, 요즘은 Googld guava 가 매우 유용한 라이브러리들을 많이 제공한다.</p>
<h2>Unit Test</h2>
<p>Java assert, Unit test (JUnit) 등을 활용하여 사전 확인 및 다양한 상황에서의 테스트를 수행하자.</p>
<h2>협업할 때는 기능 및 제약사항 등을 확실히 명시하자.</h2>
<p>NPE 는 개발자의 부주의에 의해 대부분 발생하고, 개발자의 부주의는 정보가 없어서 발생하는 경우가 많다. 아래의 내용들은 명확하게 공유하자.</p>
<ul>
<li>Method parameter 와 return value 에 대한 명세</li>
<li>Method 에서 수행하는 validation 으로 인해 발생가능한 Exception 들</li>
</ul>
<p><a href="https://github.com/google/guava">Google guava</a> 의 <em>Preconditions</em> 등을 사용하면 parameter 에 대한 validation 을 쉽게 처리할 수 있다.</p>
<p>또한 <em>Java Doc</em> 등의 문서를 적절히 사용하자. 자동으로 Java doc 을 생성해주는 프로그램도 많다. 또는 <a href="http://swagger.io">swagger</a> 등을 이용하여 RestAPI 서비스의 API 에 대한 명세를 공유할 수도 있다.</p>
<p>문서의 내용을 자세하게 채우지 않아도 된다. 위의 내용들에 대해서만이라도 명확하게 작성하자.</p>
<h2>Optional class</h2>
<p><em>Optional</em> 을 사용하면 null check 를 위한 코드를 상당히 줄일 수 있으며 코드의 Readability 를 높일 수 있다.</p>
<p>Optional 은 원래 google guava 라이브러리에서 제공되었었는데 java 8 로 버전 업하면서 자바에서도 지원(<code>java.util.Optional&lt;T&gt;</code>)하게 되었다.</p>
<p>Optional object 생성:</p>
<div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">nStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&quot;Test String&quot;</span><span class="o">;</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">eOp</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span> <span class="c1">// empty Optional 객체 생성</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">nullableOp</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">nStr</span><span class="o">);</span> <span class="c1">// null 을 허용하는 Optional 객체 생성</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">notNullableOp</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">str</span><span class="o">);</span> <span class="c1">// str 에 접근하는 시점이 아니라 Optional 객체를 생성하는 이 순간 parameter 의 null 여부를 체크하여 NPE 가 발생</span>
<span class="k">if</span><span class="o">(</span> <span class="n">notNullableOp</span><span class="o">.</span><span class="na">isPresent</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
 <span class="c1">// Optional 객체에 값이 있는지 확인 후 아래 코드를 실행</span>
 <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">notNullableOp</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
<span class="o">}</span>
<span class="n">notNullableOp</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span> <span class="c1">// Optional 객체에 값이 있는지 확인 후 전달받은 function 을 실행</span>
<span class="n">notNullableOp</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">});</span>
<span class="n">nullableOp</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span> <span class="c1">// null 이므로 실행되지 않는다.</span>
<span class="n">String</span> <span class="n">emtpyStr</span> <span class="o">=</span> <span class="n">eOp</span><span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="s">&quot;Empty String&quot;</span><span class="o">);</span> <span class="c1">// Optional 객체가 empty 일 경우 (null 일 경우) &quot;Empty String&quot; 의 reference 를 return.</span>
<span class="n">String</span> <span class="n">exStr</span> <span class="o">=</span> <span class="n">eOp</span><span class="o">.</span><span class="na">orElseThrow</span><span class="o">(</span><span class="n">Exception</span><span class="o">::</span><span class="k">new</span><span class="o">);</span> <span class="c1">// Optional 객체가 empty 일 경우 (null 일 경우) 지정된 Exception 을 throw.</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">notNullableOp</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="s">&quot;Too long string&quot;</span><span class="o">));</span>
</pre></div>


<p>Optional 과 map 을 이용하여 null check 없이 jsonNode 접근하기:</p>
<div class="highlight"><pre><span></span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">rootNode</span><span class="o">)</span>
 <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">node</span> <span class="o">-&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;secondNode&quot;</span><span class="o">))</span>
 <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">node</span> <span class="o">-&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;thirdNode&quot;</span><span class="o">))</span>
 <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">node</span> <span class="o">-&gt;</span> <span class="o">{</span>
 <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;value&quot;</span><span class="o">));</span>
 <span class="o">})</span>
</pre></div>


<p>if else 를 이용한 null 체크는 source code readability 를 떨어뜨린다. Optional 과 Java doc 을 이용한 직관적인 코드 작성을 하자.</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://imjang57.github.io/garret/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://imjang57.github.io/garret/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://imjang57.github.io/garret/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>