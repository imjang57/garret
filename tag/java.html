<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>garret - java</title>
        <link rel="stylesheet" href="https://imjang57.github.io/garret/theme/css/main.css" />
        <link href="https://imjang57.github.io/garret/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="garret Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://imjang57.github.io/garret/">garret </a></h1>
                <nav><ul>
                    <li><a href="https://imjang57.github.io/garret/pages/about.html">About</a></li>
                    <li><a href="https://imjang57.github.io/garret/category/issues.html">issues</a></li>
                    <li><a href="https://imjang57.github.io/garret/category/linux.html">linux</a></li>
                    <li><a href="https://imjang57.github.io/garret/category/mac.html">mac</a></li>
                    <li><a href="https://imjang57.github.io/garret/category/misc.html">misc</a></li>
                    <li><a href="https://imjang57.github.io/garret/category/programming.html">programming</a></li>
                    <li><a href="https://imjang57.github.io/garret/category/tools.html">tools</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://imjang57.github.io/garret/avoid-null-pointer-exception-in-java.html">NPE (NullPointerException) 을 피하자</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-01-18T00:00:00+09:00">
                Published: Wed 18 January 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-01-18T00:00:00+09:00">
                Updated: Wed 18 January 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://imjang57.github.io/garret/author/imjang57.html">imjang57</a>
        </address>
<p>In <a href="https://imjang57.github.io/garret/category/programming.html">programming</a>.</p>
<p>tags: <a href="https://imjang57.github.io/garret/tag/java.html">java</a> <a href="https://imjang57.github.io/garret/tag/npe.html">NPE</a> <a href="https://imjang57.github.io/garret/tag/nullpointerexception.html">NullPointerException</a> <a href="https://imjang57.github.io/garret/tag/null.html">null</a> </p>
</footer><!-- /.post-info --><h1>NPE(NullPointerException) 을 피하자.</h1>
<p>자바 개발을 하다보면 가장 많이 만나고 영향이 큰 예외 중 하나가 <em>NPE</em> 이다. NPE 는 개발자의 습관이나 부주의 등이 대부분 원인이다. 이를 예방하는 가장 좋은 방법은 NPE 를 피하는 코딩 습관을 갖는 것이다.</p>
<h2>null 의 의미</h2>
<p>자바에서 <code>null</code> 이란 아래와 같은 상태를 의미한다.</p>
<blockquote>
<p>아직 object 가 생성되지 않은 상태, 즉 아직 memory 할당이 되지 않은 object 상태</p>
</blockquote>
<p>NPE 는 null 상태인 object 를 참조하여 어떠한 행위(method 실행)를 하려할 때 발생하는 예외이다.</p>
<h2>NPE가 발생하는 상황</h2>
<p>NPE 는 아래와 같은 상황에서 발생할 수 있다.</p>
<ul>
<li>null object 의 method 를 호출</li>
<li>null object 의 instance member 에 접근</li>
</ul>
<h1>Avoid NPE in source code</h1>
<p>NPE 는 대부분 개발자의 부주의로 발생하므로, 개발할 때 조금만 신경쓰면 대부분의 NPE 를 예방할 수 있다.</p>
<h2>String 객체를 비교할 경우</h2>
<p><code>equals()</code>, <code>equalsIgnoreCase()</code> 등을 사용할 때 null 이 아닌 것이 확실한 객체가 있다면 해당 객체의 method 를 호출하자.</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="o">(</span> <span class="s">&quot;Compare String&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">testStr</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
 <span class="c1">// logic</span>
<span class="o">}</span>
</pre></div>


<h2>String.valueOf() 사용</h2>
<p>로그 등을 남길 때 객체의 상태를 확인하기 위해 객체의 <code>toString()</code> 을 호출하는 경우가 있는데, 객체가 null 일 경우 NPE 가 발생한다. 로그를 위해 null 을 체크하는 로직을 추가하는 것은 불필요한 코드가 될 수 있다.</p>
<p><code>toString()</code> method 보다는 <code>String.valueOf()</code> 를 사용하자.</p>
<h2>Primitive type 사용</h2>
<p>꼭 필요한 경우가 아니라면 Primitive type data 를 사용하자. NPE 를 줄이고 memory 도 더 효율적으로 사용할 수 있다.</p>
<h2>return empty collection</h2>
<p>List, Set, Map 등과 같은 Collection 을 return 하는 method 를 구현할 때, null 을 return 하지 말자. 대신 empty collection 을 return 하자. 그러면 함수를 사용하는 개발자는 불필요한 null 체크를 하지 않아도 된다.</p>
<h2>Use null-safe stuffs</h2>
<p>null 에 안전한 자바 내장 함수나 commons-lang 과 같은 helper class 를 사용하자. Apache Commons 도 좋고, 요즘은 Googld guava 가 매우 유용한 라이브러리들을 많이 제공한다.</p>
<h2>Unit Test</h2>
<p>Java assert, Unit test (JUnit) 등을 활용하여 사전 확인 및 다양한 상황에서의 테스트를 수행하자.</p>
<h2>협업할 때는 기능 및 제약사항 등을 확실히 명시하자.</h2>
<p>NPE 는 개발자의 부주의에 의해 대부분 발생하고, 개발자의 부주의는 정보가 없어서 발생하는 경우가 많다. 아래의 내용들은 명확하게 공유하자.</p>
<ul>
<li>Method parameter 와 return value 에 대한 명세</li>
<li>Method 에서 수행하는 validation 으로 인해 발생가능한 Exception 들</li>
</ul>
<p><a href="https://github.com/google/guava">Google guava</a> 의 <em>Preconditions</em> 등을 사용하면 parameter 에 대한 validation 을 쉽게 처리할 수 있다.</p>
<p>또한 <em>Java Doc</em> 등의 문서를 적절히 사용하자. 자동으로 Java doc 을 생성해주는 프로그램도 많다. 또는 <a href="http://swagger.io">swagger</a> 등을 이용하여 RestAPI 서비스의 API 에 대한 명세를 공유할 수도 있다.</p>
<p>문서의 내용을 자세하게 채우지 않아도 된다. 위의 내용들에 대해서만이라도 명확하게 작성하자.</p>
<h2>Optional class</h2>
<p><em>Optional</em> 을 사용하면 null check 를 위한 코드를 상당히 줄일 수 있으며 코드의 Readability 를 높일 수 있다.</p>
<p>Optional 은 원래 google guava 라이브러리에서 제공되었었는데 java 8 로 버전 업하면서 자바에서도 지원(<code>java.util.Optional&lt;T&gt;</code>)하게 되었다.</p>
<p>Optional object 생성:</p>
<div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">nStr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&quot;Test String&quot;</span><span class="o">;</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">eOp</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span> <span class="c1">// empty Optional 객체 생성</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">nullableOp</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">nStr</span><span class="o">);</span> <span class="c1">// null 을 허용하는 Optional 객체 생성</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">notNullableOp</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">str</span><span class="o">);</span> <span class="c1">// str 에 접근하는 시점이 아니라 Optional 객체를 생성하는 이 순간 parameter 의 null 여부를 체크하여 NPE 가 발생</span>
<span class="k">if</span><span class="o">(</span> <span class="n">notNullableOp</span><span class="o">.</span><span class="na">isPresent</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
 <span class="c1">// Optional 객체에 값이 있는지 확인 후 아래 코드를 실행</span>
 <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">notNullableOp</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
<span class="o">}</span>
<span class="n">notNullableOp</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span> <span class="c1">// Optional 객체에 값이 있는지 확인 후 전달받은 function 을 실행</span>
<span class="n">notNullableOp</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">});</span>
<span class="n">nullableOp</span><span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span> <span class="c1">// null 이므로 실행되지 않는다.</span>
<span class="n">String</span> <span class="n">emtpyStr</span> <span class="o">=</span> <span class="n">eOp</span><span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="s">&quot;Empty String&quot;</span><span class="o">);</span> <span class="c1">// Optional 객체가 empty 일 경우 (null 일 경우) &quot;Empty String&quot; 의 reference 를 return.</span>
<span class="n">String</span> <span class="n">exStr</span> <span class="o">=</span> <span class="n">eOp</span><span class="o">.</span><span class="na">orElseThrow</span><span class="o">(</span><span class="n">Exception</span><span class="o">::</span><span class="k">new</span><span class="o">);</span> <span class="c1">// Optional 객체가 empty 일 경우 (null 일 경우) 지정된 Exception 을 throw.</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">notNullableOp</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="s">&quot;Too long string&quot;</span><span class="o">));</span>
</pre></div>


<p>Optional 과 map 을 이용하여 null check 없이 jsonNode 접근하기:</p>
<div class="highlight"><pre><span></span><span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">rootNode</span><span class="o">)</span>
 <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">node</span> <span class="o">-&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;secondNode&quot;</span><span class="o">))</span>
 <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">node</span> <span class="o">-&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;thirdNode&quot;</span><span class="o">))</span>
 <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">node</span> <span class="o">-&gt;</span> <span class="o">{</span>
 <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;value&quot;</span><span class="o">));</span>
 <span class="o">})</span>
</pre></div>


<p>if else 를 이용한 null 체크는 source code readability 를 떨어뜨린다. Optional 과 Java doc 을 이용한 직관적인 코드 작성을 하자.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://imjang57.github.io/garret/jvm-process-monitoring-with-jdk-tools.html" rel="bookmark"
                           title="Permalink to JVM Process monitoring with JDK tools">JVM Process monitoring with JDK tools</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-01-18T00:00:00+09:00">
                Published: Wed 18 January 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-01-18T00:00:00+09:00">
                Updated: Wed 18 January 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://imjang57.github.io/garret/author/imjang57.html">imjang57</a>
        </address>
<p>In <a href="https://imjang57.github.io/garret/category/tools.html">tools</a>.</p>
<p>tags: <a href="https://imjang57.github.io/garret/tag/java.html">java</a> <a href="https://imjang57.github.io/garret/tag/jvm.html">jvm</a> <a href="https://imjang57.github.io/garret/tag/monitoring.html">monitoring</a> <a href="https://imjang57.github.io/garret/tag/jps.html">jps</a> <a href="https://imjang57.github.io/garret/tag/stat.html">stat</a> <a href="https://imjang57.github.io/garret/tag/stack.html">stack</a> </p>
</footer><!-- /.post-info -->                <p>JDK Tools 을 사용하여 JVM Process 를 모니터링하는 방법에 대한 소개</p>
                <a class="readmore" href="https://imjang57.github.io/garret/jvm-process-monitoring-with-jdk-tools.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://imjang57.github.io/garret/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-90095241-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>